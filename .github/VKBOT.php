<?php
require 'db.php';
include "vk_api.php";

const VK_KEY = "43e04b5c6040b9c91290329212e7255d35e6525b2e1a3a029ab734058651a586da03c04ba0877a8ae221a";
const ACCESS_KEY = "082287";
const VERSION = "5.81";

$vk = new vk_api(VK_KEY, VERSION);
$data = json_decode(file_get_contents('php://input'));
//print_r($data);
if ($data->type == 'confirmation') {
    exit(ACCESS_KEY);
}
$vk->sendOK();
// ---------- –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ ----------
$peer_id = $data->object->peer_id;
$id = $data->object->from_id;
$chat_id = $peer_id - 2000000000;
$is_admin = [597334435]; // —Å–æ–∑–¥–∞–µ–º –º–∞—Å—Å–∏–≤ —Å ID's –Ω–∞—à–∏—Ö –±—É–¥—É—â–∏—Ö –∞–¥–º–∏–Ω–æ–≤ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é
// ---------- –°–æ–æ–±—â–µ–Ω–∏–µ ----------
$message = $data->object->text;
$messages = explode(" ", $message);
$cmd = mb_strtolower(str_replace(array("/", "!"), "", $messages[0]));
$args = array_slice($messages, 1);
// ---------- –î—Ä—É–≥–æ–µ ----------
$reply_message = $data->object->reply_message;
$reply_author = $data->object->reply_message->from_id;
$chat_act = $data->object->action;
$fwd_messages = $object['fwd_messages'];
if(empty($fwd_messages) && !empty($reply_message)) {
  array_push($fwd_messages, $reply_message);
}
if(empty($reply_message) && !empty($fwd_messages)) {
  $reply_message = $fwd_messages[0];
}
if ( !R::testConnection() )
{
    $vk->sendMessage($peer_id, "–ù–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö, –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º ");
    exit;
}
if ($data->type == 'message_new') {
	$userInfo = $vk->request("users.get", ["user_ids" => $id]);
    $first_name = $userInfo[0]['first_name'];
    $first_name2 = $userInfo[0]['last_name'];
    //---------------------------------------------------------
    $user = R::findOne('users', 'user_id = ?', [$id]);
    if($id <= '-') exit; // –¢.–∫. –∏–¥ –Ω–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∑–∞–≤–µ—Ä—à–∏–ª–∏ —Å–∫—Ä–∏–ø—Ç
    if(!$user){
        $vk->registrationUser($id);
        $vk->sendMessage($peer_id, "@id{$id} ({$first_name}), –¥–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å )))"); // –£–≤–µ–¥–æ–º–∏–ª–∏ —á—Ç–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ
        exit; // –ó–∞–≤–µ—Ä—à–∏–ª–∏ —Å–∫—Ä–∏–ø—Ç –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –æ—à–∏–±–æ–∫
    }
//--------------------------------------------------------------------------------------------
  if($chat_id > 0){//–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –∞–¥–º–∏–Ω–∫–∏—É –≤ —á–∞—Ç–µ
    if(!$vk->isChatAdmin($peer_id)){
      $vk->sendMessage($peer_id, "‚ö† –ú–Ω–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ ‚ö†");
      exit;
    }
    else{// –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é —á–∞—Ç–∞
      $chat = R::findOne('settings', 'peer_id = ?', [$peer_id]);
      if(!$chat){
        $vk->registrationChatSettings($peer_id);
      }
    }
  }

//--------------------------------------------------------------------------------------------
    if($user){
        $user['score'] = $user['score'] +1; // –û—Ç–ø—Ä–∞–≤–∏–ª–∏ —É–∫–∞–∑–∞–Ω–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —Å—É–º–º—É
        R::store($user); // –ó–∞–ø–∏—Å–∞–ª–∏ –≤ –±–∞–∑—É
		
		if ($user['score'] == 300) {
        	$user['status'] = 1; // 
        	R::store($user); // –ó–∞–ø–∏—Å–∞–ª–∏ –≤ –±–∞–∑—É
			$vk->sendMessage($peer_id, "@id{$id} ({$first_name}), –£ –≤–∞—Å –Ω–æ–≤–æ–µ –∑–≤–∞–Ω–∏–µ: –ù–æ–≤–∏—á–æ–∫!");
		} elseif ($user['score'] == 600) {
        	$user['status'] = 2; // 
        	R::store($user); // –ó–∞–ø–∏—Å–∞–ª–∏ –≤ –±–∞–∑—É
			$vk->sendMessage($peer_id, "@id{$id} ({$first_name}), –£ –≤–∞—Å –Ω–æ–≤–æ–µ –∑–≤–∞–Ω–∏–µ: –ü–æ—Å—Ç–æ—è–ª–µ—Ü!");
		} elseif ($user['score'] == 1000) {
        	$user['status'] = 3; // 
        	R::store($user); // –ó–∞–ø–∏—Å–∞–ª–∏ –≤ –±–∞–∑—É
			$vk->sendMessage($peer_id, "@id{$id} ({$first_name}), –£ –≤–∞—Å –Ω–æ–≤–æ–µ –∑–≤–∞–Ω–∏–µ: –ü–∏—Å–∞—Ç–µ–ª—å!");
		} elseif ($user['score'] == 2000) {
        	$user['status'] = 4; // 
        	R::store($user); // –ó–∞–ø–∏—Å–∞–ª–∏ –≤ –±–∞–∑—É
			$vk->sendMessage($peer_id, "@id{$id} ({$first_name}), –£ –≤–∞—Å –Ω–æ–≤–æ–µ –∑–≤–∞–Ω–∏–µ: –§–∏–ª–æ—Å–æ—Ñ!");
		} elseif ($user['score'] == 3000) {	
        	$user['status'] = 5; // 
        	R::store($user); // –ó–∞–ø–∏—Å–∞–ª–∏ –≤ –±–∞–∑—É
			$vk->sendMessage($peer_id, "@id{$id} ({$first_name}), –£ –≤–∞—Å –Ω–æ–≤–æ–µ –∑–≤–∞–Ω–∏–µ: –ú–∞—Å—Ç–µ—Ä!");
		} elseif ($user['score'] == 5000) {
        	$user['status'] = 6; // 
        	R::store($user); // –ó–∞–ø–∏—Å–∞–ª–∏ –≤ –±–∞–∑—É
			$vk->sendMessage($peer_id, "@id{$id} ({$first_name}), –£ –≤–∞—Å –Ω–æ–≤–æ–µ –∑–≤–∞–Ω–∏–µ: –ó–≤–µ–∑–¥–Ω—ã–π –≥—É—Ä—É!");
		}
	} 	

  if(in_array($cmd, ['–ø–æ–º–æ—â—å', 'help'])){
    if($chat_id > 0){ // –ï—Å–ª–∏ —ç—Ç–æ –±–µ—Å–µ–¥–∞
	  $vk->sendMessage($peer_id, "–ö–æ–º–∞–Ω–¥–∞ '–ø–æ–º–æ—â—å' –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ –≤ –ª—Å –±–æ—Ç—É!");
    }else{ // –ï—Å–ª–∏ —ç—Ç–æ –ª—Å —Å –±–æ—Ç–æ–º
	  $vk->sendMessage($peer_id, "–°–ø–∏—Å–æ–∫ –∫–æ–º–∞–Ω–¥ (–≤–≤–æ–¥–∏—Ç–µ –±–µ–∑ —Å–∫–æ–±–∞–∫[]): <br>–±–∞–ª–∞–Ω—Å - –£–∑–Ω–∞—Ç—å —Å–∫–æ–ª—å–∫–æ –∫—Ä–µ–º–ø–∞–µ–≤<br>—Å—Ç–∞—Ç—É—Å - –£–∑–Ω–∞—Ç—å —Å–≤–æ—ë –∑–≤–∞–Ω–∏–µ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É<br>–ø–µ—Ä–µ–¥–∞—Ç—å [–∫–æ–º—É] [—Å–∫–æ–ª—å–∫–æ] - –ü–µ—Ä–∞–¥–∞—Ç—å —Å–≤–æ–∏ –∫—Ä–µ–º–ø–∞–∏<br>–æ–Ω–ª–∞–π–Ω - –£–∑–Ω–∞—Ç—å –æ–Ω–ª–∞–π–Ω<br>–ø–æ–≥–æ–¥–∞ [–≥–æ—Ä–æ–¥] - –£–∑–Ω–∞—Ç—å –ø–æ–≥–æ–¥—É<br>—Ç–æ–ø - –¢–æ–ø 5 –ø–æ —Å–æ–æ–±—â–µ–Ω–∏—è–º<br>–∞—Ä—Ç - –†–∞–Ω–¥–æ–º –∫–∞—Ä—Ç–∏–Ω–∫–∏<br>–≤–∏–¥–µ–æ - –†–∞–Ω–¥–æ–º–Ω–æ–µ –≤–∏–¥–µ–æ");
    }
  }
  
  if(in_array($cmd, ['–±–æ—Ç', 'bot'])){
    if($chat_id > 0){ // –ï—Å–ª–∏ —ç—Ç–æ –±–µ—Å–µ–¥–∞
      $vk->sendMessage($peer_id, "–≠—Ç–∞ –≤–µ—Ä—Å–∏—è –±–æ—Ç–∞ –≤ —Å—Ç–∞–¥–∏–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏!<br>–ê–≤—Ç–æ—Ä –¥–∞–Ω–Ω–æ–≥–æ –±–æ—Ç–∞: –ë–∏–∫–±–∞–π");
    }else{ // –ï—Å–ª–∏ —ç—Ç–æ –ª—Å —Å –±–æ—Ç–æ–º
      $vk->sendMessage($peer_id, "–ö–æ–º–∞–Ω–¥–∞ '–±–æ—Ç' –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ –≤ –±–µ—Å–µ–¥–∞—Ö");
    }
  }
  
  
   if(in_array($cmd, ['–±–∞–ª–∞–Ω—Å', 'balans'])){
     $get_user = R::findOne('users', 'user_id = ?', [$id]);
	 $balancebd = $get_user['balance'];
	 $vk->sendMessage($peer_id, "@id{$id} ({$first_name}), –í–∞—à –±–∞–ª–∞–Ω—Å: {$balancebd} –∫—Ä–µ–º–ø–∞–µ–≤!");
  }
  
	if(in_array($cmd, ['status', '—Å—Ç–∞—Ç—É—Å'])){
    if($chat_id > 0){ // –ï—Å–ª–∏ —ç—Ç–æ –±–µ—Å–µ–¥–∞
	 $scoreall = $user['score'];
		if ($user['status'] == 0) {
        	$zvaniestr = "–¢–µ–Ω—å";
		} elseif ($user['status'] == 1) {
        	$zvaniestr = "–ù–æ–≤–∏—á–æ–∫";
		} elseif ($user['status'] == 2) {
        	$zvaniestr = "–ü–æ—Å—Ç–æ—è–ª–µ—Ü";
		} elseif ($user['status'] == 3) {
        	$zvaniestr = "–ü–∏—Å–∞—Ç–µ–ª—å";
		} elseif ($user['status'] == 4) {
        	$zvaniestr = "–§–∏–ª–æ—Å–æ—Ñ";
		} elseif ($user['status'] == 5) {	
        	$zvaniestr = "–ú–∞—Å—Ç–µ—Ä";
		} elseif ($user['status'] == 6) {
        	$zvaniestr = "–ó–≤–µ–∑–¥–Ω—ã–π –≥—É—Ä—É";
		} elseif ($user['status'] == 7) {
        	$zvaniestr = "–õ–∏—á–Ω–∞—è —Å—É—á–∫–∞ –∞–¥–º–∏–Ω–∞";
		} elseif ($user['status'] == 8) {
        	$zvaniestr = "–ë–æ–≥ –•–µ–Ω—Ç–∞—è";
		} elseif ($user['status'] == 9) {
        	$zvaniestr = "–ö—Ä–æ–≤–∞–≤—ã–π –∞–Ω–≥–µ–ª";
		}
	$vk->sendMessage($peer_id, "@id{$id} ({$first_name}), –í–∞—à–µ –∑–≤–∞–Ω–∏–µ: {$zvaniestr}! <br>–ü–µ—Ä–≤–æ–µ –ø–æ—è–≤–ª–µ–Ω–∏–µ: ‚ùó{$user['regDate']}<br>–í—Å–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏–π –æ—Ç –≤–∞—Å: {$scoreall}");
	
    }else{ // –ï—Å–ª–∏ —ç—Ç–æ –ª—Å —Å –±–æ—Ç–æ–º
      $vk->sendMessage($peer_id, "–ö–æ–º–∞–Ω–¥–∞ '—Å—Ç–∞—Ç—É—Å' –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ –≤ –±–µ—Å–µ–¥–∞—Ö");
    }
  }
 // ---------- –ö–∞—Ä—Ç–∏–Ω–∫–∏ ----------
	if(in_array($cmd, ['art', '–∞—Ä—Ç'])){
    if($chat_id > 0){ // –ï—Å–ª–∏ —ç—Ç–æ –±–µ—Å–µ–¥–∞
        $img = ['-1_456239099', '-1_456239099'];
		$rand_img = array_rand($img, 1);
		$vk->request('messages.send', ['peer_id' => $peer_id, 'message' => '', 'attachment' => "photo{$img[$rand_img]}"]);
    }else{ // –ï—Å–ª–∏ —ç—Ç–æ –ª—Å —Å –±–æ—Ç–æ–º
      $vk->sendMessage($peer_id, "–ö–æ–º–∞–Ω–¥–∞ '–∞—Ä—Ç' –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ –≤ –±–µ—Å–µ–¥–∞—Ö");
    }
  }
	if(in_array($cmd, ['media', '–≤–∏–¥–µ–æ'])){
    if($chat_id > 0){ // –ï—Å–ª–∏ —ç—Ç–æ –±–µ—Å–µ–¥–∞
        $img = ['-1_456239018', '-1_456239018'];
		$rand_img = array_rand($img, 1);
		$vk->request('messages.send', ['peer_id' => $peer_id, 'message' => '', 'attachment' => "video{$img[$rand_img]}"]);
    }else{ // –ï—Å–ª–∏ —ç—Ç–æ –ª—Å —Å –±–æ—Ç–æ–º
      $vk->sendMessage($peer_id, "–ö–æ–º–∞–Ω–¥–∞ 'media' –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ –≤ –±–µ—Å–µ–¥–∞—Ö");
    }
  }
  if(in_array($cmd, ['top', '—Ç–æ–ø'])){
    $topUser = R::findAll('users' , ' ORDER BY score DESC LIMIT 5 '); //–∑–∞–ø—Ä–æ—Å–∏–ª–∏ 5 –∑–∞–ø–∏—Å–µ–π —Å –Ω–∞–∏–±–æ–ª—å—à–∏–º –∑–Ω–∞—á–µ–Ω–∏–µ–º –∫–æ–ª–æ–Ω–∫–µ score –≤ —Ç–∞–±–ª–∏—Ü–µ users
	$strtop5;
    foreach ($topUser as $usertop) { //–¶–∏–∫–ª. –ü–æ–¥—Ä–æ–±–Ω–µ–µ –ø–æ—á–∏—Ç–∞–π—Ç–µ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –∫ PHP
       $strtop5 .= "@id{$usertop['user_id']} ({$usertop['nick']}) –Ω–∞–±—Ä–∞–ª {$usertop['score']} —Å–æ–æ–±—â–µ–Ω–∏–π<br>"; // –í—ã–≤–æ–¥–∏–º –Ω—É–∂–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
    }
	$allUsers = R::count('users');
	$vk->sendMessage($peer_id, "–¢–æ–ø 5 –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É —Å–æ–æ–±—â–µ–Ω–∏–π!<br><br>{$strtop5}<br><br> –í—Å–µ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤: {$allUsers}"); // –ü–∏—à–µ–º
  }
 // ---------- ---------------------------- –∞–¥–º–∏–Ω –∫–æ–º–∞–Ω–¥–∞
  if(in_array($cmd, ['kick'])){
	if (in_array($id, $is_admin) || $user['admin'] >= 1) { // –° –ø–æ–º–æ—â—å—é in_array –ø—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ö–æ–∂–µ—Å—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π $id —Å –º–∞—Å—Å–∏–≤–æ–º —Å ID's - –∞–º–¥–∏–Ω –∏–ª–∏ –Ω–µ—Ç
    $trUser = $reply_author; // –°–æ–∑–¥–∞–ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –∫–æ–º—É –ø–µ—Ä–µ–≤–µ—Å—Ç–∏
    if($trUser == ''){ // –£–∑–Ω–∞–µ–º —É–∫–∞–∑–∞–ª –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∫–æ–º—É –ø–µ—Ä–µ–≤–µ—Å—Ç–∏ –ø—Ä–∏ –ø–æ–º–æ—â–∏ –ø–µ—Ä–µ—Å–ª–∞–Ω–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
      if($args[0] == ''){ // –ü—Ä–æ–≤–µ—Ä–∏–ª–∏ –≤–≤–µ–ª–∏ –ª–∏ –Ω–∞–º –¥–≤–∞ –∞—Ä–≥—É–º–µ–Ω—Ç–∞ (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏ —Å—É–º–º–∞) –µ—Å–ª–∏ –ø–µ—Ä–µ—Å–ª–∞–Ω–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–µ—Ç
        $vk->sendMessage($peer_id, "@id{$id} ({$user['nick']}) –í—ã –Ω–µ —É–∫–∞–∑–∞–ª–∏ –∫–æ–≥–æ –∫–∏–∫–Ω—É—Ç—å!");
        exit; // –ó–∞–≤–µ—Ä—à–∏–ª–∏ —Å–∫—Ä–∏–ø—Ç —Ç.–∫. –Ω–µ —É–∫–∞–∑–∞–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥–∞
      }
      if($args[1] == ''){ // –ü—Ä–æ–≤–µ—Ä–∏–ª–∏ –≤–≤–µ–ª–∏ –ª–∏ –Ω–∞–º –¥–≤–∞ –∞—Ä–≥—É–º–µ–Ω—Ç–∞ (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏ —Å—É–º–º–∞) –µ—Å–ª–∏ –ø–µ—Ä–µ—Å–ª–∞–Ω–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–µ—Ç
        $vk->sendMessage($peer_id, "@id{$id} ({$user['nick']}) –í—ã –Ω–µ —É–∫–∞–∑–∞–ª–∏ –ø—Ä–∏—á–∏–Ω—É!");
        exit; // –ó–∞–≤–µ—Ä—à–∏–ª–∏ —Å–∫—Ä–∏–ø—Ç —Ç.–∫. –Ω–µ —É–∫–∞–∑–∞–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥–∞
      }
	  $trUser = $args[0]; // –ó–∞–ø–∏—Å–∞–ª–∏ –∫–æ–º—É –ø–µ—Ä–µ–≤–µ—Å—Ç–∏ –∏–∑ –∞—Ä–≥—É–º–µ—Ç–∞
      $Prosina = $args[1]; // –∑–∞–º–µ–Ω–∏–ª–∏ –≤ —Å—É–º–º–µ id –Ω–∞ —Å—É–º–º—É –ø–µ—Ä–µ–≤–æ–¥–∞
    }
    $trUser = preg_replace('/\D/', '', $trUser); // –£–±—Ä–∞–ª–∏ –≤—Å–µ –±—É–∫–≤—ã –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π id –ø–æ–ª—å–∑–æ–∞–≤—Ç–µ–ª—è –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥–∞
    if($trUser == ''){ // –ø—Ä–æ–≤–µ—Ä—è–µ–º —Å—É–º–º—É –Ω–∞ –ø—É—Å—Ç–æ—Ç—É (–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
      $vk->sendMessage($peer_id, "@id{$id} ({$user['nick']})–í—ã –Ω–µ —É–∫–∞–∑–∞–ª–∏ –∫–æ–≥–æ –∫–∏–∫–Ω—É—Ç—å!");
      exit; // –¢.–∫. —Å—É–º–º–∞ –Ω–µ —É–∫–∞–∑–∞–Ω–∞ –º—ã –∑–∞–≤–µ—Ä—à–∏–ª–∏ —Å–∫—Ä–∏–ø—Ç
    }else{ // –ï—Å–ª–∏ —Å—É–º–º–∞ —É–∫–∞–∑–∞–Ω–∞, —Ç–æ –¥–µ–ª–∞–µ–º –ø–µ—Ä–µ–≤–æ–¥ (–ø–æ—á—Ç–∏)
      $findTrUser = R::findOne('users', 'user_id = ?', [$trUser]);
      if($findTrUser){
		$newUser2 = R::dispense("usersban"); // –í—ã–±—Ä–∞–ª–∏ —Ç–∞–±–ª–∏—Ü—É
    	$newUser2->user_id = $findTrUser['user_id'];
		$newUser2->user_name = $findTrUser['nick']; 
    	$newUser2->admin_id = $id;
		$newUser2->admin_name = $user['nick']; 
    	$newUser2->prisina = $Prosina;
    	$newUser2->dateBan = date("d.m.Y, H:i:s");
		$newUser2->beseda_id = $chat_id;
    	R::store($newUser2); // –ó–∞–ø–∏—Å–∞–ª–∏ –≤ –±–∞–∑—É
	
        $vk->sendMessage($peer_id, "@id{$id} ({$user['nick']}), –≤—ã–≥–Ω–∞–ª @id{$findTrUser['user_id']} ({$findTrUser['nick']}), –ø–æ –ø—Ä–∏—á–∏–Ω–µ: {$Prosina}"); // –ü–∏—à–µ–º —á—Ç–æ –ø–µ—Ä–µ–≤–æ–¥ –ø—Ä–æ—à–µ–ª —É—Å–ø–µ—à–Ω–æ
        $vk->sendMessage($findTrUser['user_id'], "@id{$id} ({$user['nick']}) –≤—ã–≥–Ω–∞–ª –≤–∞—Å, –ø–æ –ø—Ä–∏—á–∏–Ω–µ: {$Prosina}"); // –ü–∏—à–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —á—Ç–æ –µ–º—É –∫–∏–Ω—É–ª–∏ –∫–æ–∏–Ω–æ–≤
		$vk->request('messages.removeChatUser', ['chat_id' => $chat_id, 'member_id' => $findTrUser['user_id']]);
      }else{
        $vk->sendMessage($peer_id, "@id{$id} ({$user['nick']}), —É–∫–∞–∑–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –±—ã–ª –Ω–∞–π–¥–µ–Ω –≤ –±–∞–∑–µ!");
        exit; // –≤ –±–∞–∑–µ –Ω–µ—Ç —É–∫–∞–∑–∞–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑-–∑–∞ —á–µ–≥–æ –∑–∞–≤–µ—Ä—à–∞–µ–º —Å–∫—Ä–∏–ø—Ç
      }
    }
    } else {
            $vk->sendMessage($peer_id, "–î–æ—Å—Ç—É–ø–Ω–æ —Ç–æ–ª—å–∫–æ –¥–ª—è –ª–∏—á–Ω—ã—Ö —Å—É—á–µ–∫!");

        }
  }
   if(in_array($cmd, ['setadmin'])){
	if (in_array($id, $is_admin)) { // –° –ø–æ–º–æ—â—å—é in_array –ø—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ö–æ–∂–µ—Å—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π $id —Å –º–∞—Å—Å–∏–≤–æ–º —Å ID's - –∞–º–¥–∏–Ω –∏–ª–∏ –Ω–µ—Ç
    $trUser = $reply_author; // –°–æ–∑–¥–∞–ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –∫–æ–º—É –ø–µ—Ä–µ–≤–µ—Å—Ç–∏
    if($trUser == ''){ // –£–∑–Ω–∞–µ–º —É–∫–∞–∑–∞–ª –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∫–æ–º—É –ø–µ—Ä–µ–≤–µ—Å—Ç–∏ –ø—Ä–∏ –ø–æ–º–æ—â–∏ –ø–µ—Ä–µ—Å–ª–∞–Ω–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
      if($args[0] == ''){ // –ü—Ä–æ–≤–µ—Ä–∏–ª–∏ –≤–≤–µ–ª–∏ –ª–∏ –Ω–∞–º –¥–≤–∞ –∞—Ä–≥—É–º–µ–Ω—Ç–∞ (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏ —Å—É–º–º–∞) –µ—Å–ª–∏ –ø–µ—Ä–µ—Å–ª–∞–Ω–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–µ—Ç
        $vk->sendMessage($peer_id, "@id{$id} ({$user['nick']}) –í—ã –Ω–µ —É–∫–∞–∑–∞–ª–∏ –∫–æ–º—É –≤—ã–¥–∞—Ç—å!");
        exit; // –ó–∞–≤–µ—Ä—à–∏–ª–∏ —Å–∫—Ä–∏–ø—Ç —Ç.–∫. –Ω–µ —É–∫–∞–∑–∞–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥–∞
      }
      if($args[1] == ''){ // –ü—Ä–æ–≤–µ—Ä–∏–ª–∏ –≤–≤–µ–ª–∏ –ª–∏ –Ω–∞–º –¥–≤–∞ –∞—Ä–≥—É–º–µ–Ω—Ç–∞ (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏ —Å—É–º–º–∞) –µ—Å–ª–∏ –ø–µ—Ä–µ—Å–ª–∞–Ω–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–µ—Ç
        $vk->sendMessage($peer_id, "@id{$id} ({$user['nick']}) –í—ã –Ω–µ —É–∫–∞–∑–∞–ª–∏ —É—Ä–æ–≤–µ–Ω—å!");
        exit; // –ó–∞–≤–µ—Ä—à–∏–ª–∏ —Å–∫—Ä–∏–ø—Ç —Ç.–∫. –Ω–µ —É–∫–∞–∑–∞–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥–∞
      }
	  $trUser = $args[0]; // –ó–∞–ø–∏—Å–∞–ª–∏ –∫–æ–º—É –ø–µ—Ä–µ–≤–µ—Å—Ç–∏ –∏–∑ –∞—Ä–≥—É–º–µ—Ç–∞
      $lvladmin = preg_replace('/\D/', '', $args[1]); // –∑–∞–º–µ–Ω–∏–ª–∏ –≤ —Å—É–º–º–µ id –Ω–∞ —Å—É–º–º—É –ø–µ—Ä–µ–≤–æ–¥–∞
    }
    $trUser = preg_replace('/\D/', '', $trUser); // –£–±—Ä–∞–ª–∏ –≤—Å–µ –±—É–∫–≤—ã –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π id –ø–æ–ª—å–∑–æ–∞–≤—Ç–µ–ª—è –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥–∞
    if($trUser == ''){ // –ø—Ä–æ–≤–µ—Ä—è–µ–º —Å—É–º–º—É –Ω–∞ –ø—É—Å—Ç–æ—Ç—É (–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
      $vk->sendMessage($peer_id, "@id{$id} ({$user['nick']})–í—ã –Ω–µ —É–∫–∞–∑–∞–ª–∏ –∫–æ–º—É –≤—ã–¥–∞—Ç—å!");
      exit; // –¢.–∫. —Å—É–º–º–∞ –Ω–µ —É–∫–∞–∑–∞–Ω–∞ –º—ã –∑–∞–≤–µ—Ä—à–∏–ª–∏ —Å–∫—Ä–∏–ø—Ç
    }else{ // –ï—Å–ª–∏ —Å—É–º–º–∞ —É–∫–∞–∑–∞–Ω–∞, —Ç–æ –¥–µ–ª–∞–µ–º –ø–µ—Ä–µ–≤–æ–¥ (–ø–æ—á—Ç–∏)
      $findTrUser = R::findOne('users', 'user_id = ?', [$trUser]);
      if($findTrUser){
        $findTrUser['admin'] = $lvladmin; //
		R::store($findTrUser); // –ó–∞–ø–∏—Å–∞–ª–∏ –≤ –±–∞–∑—É
		$upadmin = R::dispense("usersadmin"); // –í—ã–±—Ä–∞–ª–∏ —Ç–∞–±–ª–∏—Ü—É
    	$upadmin->user_id = $findTrUser['user_id'];
		$upadmin->user_name = $findTrUser['nick']; 
    	$upadmin->admin_id = $id;
		$upadmin->admin_name = $user['nick']; 
    	$upadmin->lvl = $lvladmin;
    	$upadmin->dateAdmin = date("d.m.Y, H:i:s");
		$upadmin->beseda_id = $chat_id;
    	R::store($upadmin); // –ó–∞–ø–∏—Å–∞–ª–∏ –≤ –±–∞–∑—É
	
        $vk->sendMessage($peer_id, "@id{$id} ({$user['nick']}), –Ω–∞–∑–Ω–∞—á–∏–ª @id{$findTrUser['user_id']} ({$findTrUser['nick']}) –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º {$lvladmin} —É—Ä–æ–≤–Ω—è!"); // –ü–∏—à–µ–º
        $vk->sendMessage($findTrUser['user_id'], "@id{$id} ({$user['nick']}) –Ω–∞–∑–Ω–∞—á–∏–ª –≤–∞—Å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º {$lvladmin} —É—Ä–æ–≤–Ω—è!"); // –ü–∏—à–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
      }else{
        $vk->sendMessage($peer_id, "@id{$id} ({$user['nick']}), —É–∫–∞–∑–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –±—ã–ª –Ω–∞–π–¥–µ–Ω –≤ –±–∞–∑–µ!");
        exit; // –≤ –±–∞–∑–µ –Ω–µ—Ç —É–∫–∞–∑–∞–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑-–∑–∞ —á–µ–≥–æ –∑–∞–≤–µ—Ä—à–∞–µ–º —Å–∫—Ä–∏–ø—Ç
      }
    }
    } else {
            //$vk->sendMessage($peer_id, "–î–æ—Å—Ç—É–ø–Ω–æ —Ç–æ–ª—å–∫–æ –¥–ª—è —Å–æ–∑–¥–∞—Ç–µ–ª—è –ë–æ—Ç–∞!");

        }
  }
   if(in_array($cmd, ['setbalans'])){
	if (in_array($id, $is_admin)) { // –° –ø–æ–º–æ—â—å—é in_array –ø—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ö–æ–∂–µ—Å—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π $id —Å –º–∞—Å—Å–∏–≤–æ–º —Å ID's - –∞–º–¥–∏–Ω –∏–ª–∏ –Ω–µ—Ç
    $trUser = $reply_author; // –°–æ–∑–¥–∞–ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –∫–æ–º—É –ø–µ—Ä–µ–≤–µ—Å—Ç–∏
    if($trUser == ''){ // –£–∑–Ω–∞–µ–º —É–∫–∞–∑–∞–ª –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∫–æ–º—É –ø–µ—Ä–µ–≤–µ—Å—Ç–∏ –ø—Ä–∏ –ø–æ–º–æ—â–∏ –ø–µ—Ä–µ—Å–ª–∞–Ω–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
      if($args[0] == ''){ // –ü—Ä–æ–≤–µ—Ä–∏–ª–∏ –≤–≤–µ–ª–∏ –ª–∏ –Ω–∞–º –¥–≤–∞ –∞—Ä–≥—É–º–µ–Ω—Ç–∞ (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏ —Å—É–º–º–∞) –µ—Å–ª–∏ –ø–µ—Ä–µ—Å–ª–∞–Ω–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–µ—Ç
        $vk->sendMessage($peer_id, "@id{$id} ({$user['nick']}) –í—ã –Ω–µ —É–∫–∞–∑–∞–ª–∏ –∫–æ–º—É –≤—ã–¥–∞—Ç—å!");
        exit; // –ó–∞–≤–µ—Ä—à–∏–ª–∏ —Å–∫—Ä–∏–ø—Ç —Ç.–∫. –Ω–µ —É–∫–∞–∑–∞–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥–∞
      }
      if($args[1] == ''){ // –ü—Ä–æ–≤–µ—Ä–∏–ª–∏ –≤–≤–µ–ª–∏ –ª–∏ –Ω–∞–º –¥–≤–∞ –∞—Ä–≥—É–º–µ–Ω—Ç–∞ (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏ —Å—É–º–º–∞) –µ—Å–ª–∏ –ø–µ—Ä–µ—Å–ª–∞–Ω–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–µ—Ç
        $vk->sendMessage($peer_id, "@id{$id} ({$user['nick']}) –í—ã –Ω–µ —É–∫–∞–∑–∞–ª–∏ —É—Ä–æ–≤–µ–Ω—å!");
        exit; // –ó–∞–≤–µ—Ä—à–∏–ª–∏ —Å–∫—Ä–∏–ø—Ç —Ç.–∫. –Ω–µ —É–∫–∞–∑–∞–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥–∞
      }
	  $trUser = $args[0]; // –ó–∞–ø–∏—Å–∞–ª–∏ –∫–æ–º—É –ø–µ—Ä–µ–≤–µ—Å—Ç–∏ –∏–∑ –∞—Ä–≥—É–º–µ—Ç–∞
      $lvladmin = preg_replace('/\D/', '', $args[1]); // –∑–∞–º–µ–Ω–∏–ª–∏ –≤ —Å—É–º–º–µ id –Ω–∞ —Å—É–º–º—É –ø–µ—Ä–µ–≤–æ–¥–∞
    }
    $trUser = preg_replace('/\D/', '', $trUser); // –£–±—Ä–∞–ª–∏ –≤—Å–µ –±—É–∫–≤—ã –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π id –ø–æ–ª—å–∑–æ–∞–≤—Ç–µ–ª—è –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥–∞
    if($trUser == ''){ // –ø—Ä–æ–≤–µ—Ä—è–µ–º —Å—É–º–º—É –Ω–∞ –ø—É—Å—Ç–æ—Ç—É (–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
      $vk->sendMessage($peer_id, "@id{$id} ({$user['nick']})–í—ã –Ω–µ —É–∫–∞–∑–∞–ª–∏ –∫–æ–º—É –≤—ã–¥–∞—Ç—å!");
      exit; // –¢.–∫. —Å—É–º–º–∞ –Ω–µ —É–∫–∞–∑–∞–Ω–∞ –º—ã –∑–∞–≤–µ—Ä—à–∏–ª–∏ —Å–∫—Ä–∏–ø—Ç
    }else{ // –ï—Å–ª–∏ —Å—É–º–º–∞ —É–∫–∞–∑–∞–Ω–∞, —Ç–æ –¥–µ–ª–∞–µ–º –ø–µ—Ä–µ–≤–æ–¥ (–ø–æ—á—Ç–∏)
      $findTrUser = R::findOne('users', 'user_id = ?', [$trUser]);
      if($findTrUser){
		$findTrUser['balance'] = $findTrUser['balance'] + $lvladmin;
		R::store($findTrUser); // –ó–∞–ø–∏—Å–∞–ª–∏ –≤ –±–∞–∑—É
		$upadmin = R::dispense("usersbalans"); // –í—ã–±—Ä–∞–ª–∏ —Ç–∞–±–ª–∏—Ü—É
    	$upadmin->user_id = $findTrUser['user_id'];
		$upadmin->user_name = $findTrUser['nick']; 
    	$upadmin->admin_id = $id;
		$upadmin->admin_name = $user['nick']; 
    	$upadmin->balansup = $lvladmin;
    	$upadmin->dateAdmin = date("d.m.Y, H:i:s");
		$upadmin->beseda_id = $chat_id;
    	R::store($upadmin); // –ó–∞–ø–∏—Å–∞–ª–∏ –≤ –±–∞–∑—É
	
        $vk->sendMessage($peer_id, "@id{$id} ({$user['nick']}), –≤—ã–¥–∞–ª @id{$findTrUser['user_id']} ({$findTrUser['nick']}) {$lvladmin} –∫—Ä–µ–º–ø–∞–µ–≤!"); // –ü–∏—à–µ–º
        $vk->sendMessage($findTrUser['user_id'], "@id{$id} ({$user['nick']}) –≤—ã–¥–∞–ª –≤–∞–º {$lvladmin} –∫—Ä–µ–º–ø–∞–µ–≤!"); // –ü–∏—à–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
      }else{
        $vk->sendMessage($peer_id, "@id{$id} ({$user['nick']}), —É–∫–∞–∑–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –±—ã–ª –Ω–∞–π–¥–µ–Ω –≤ –±–∞–∑–µ!");
        exit; // –≤ –±–∞–∑–µ –Ω–µ—Ç —É–∫–∞–∑–∞–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑-–∑–∞ —á–µ–≥–æ –∑–∞–≤–µ—Ä—à–∞–µ–º —Å–∫—Ä–∏–ø—Ç
      }
    }
    } else {
            //$vk->sendMessage($peer_id, "–î–æ—Å—Ç—É–ø–Ω–æ —Ç–æ–ª—å–∫–æ –¥–ª—è —Å–æ–∑–¥–∞—Ç–µ–ª—è –ë–æ—Ç–∞!");

        }
  }
//--------------------------------------------------------------------------------------------
  if(in_array($cmd, ['–ø–µ—Ä–µ–≤–æ–¥', '–ø–µ—Ä–µ–≤–µ—Å—Ç–∏', '–ø–µ—Ä–µ–¥–∞—Ç—å'])){
    $trUser = $reply_author; // –°–æ–∑–¥–∞–ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –∫–æ–º—É –ø–µ—Ä–µ–≤–µ—Å—Ç–∏
    $sumTr = preg_replace('/\D/', '', $args[0]); // –£–∫–∞–∑–∞–ª–∏ —Å—É–º–º—É –ø–µ—Ä–µ–≤–æ–¥–∞ –±–µ–∑ –±—É–∫–≤
    if($trUser == ''){ // –£–∑–Ω–∞–µ–º —É–∫–∞–∑–∞–ª –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∫–æ–º—É –ø–µ—Ä–µ–≤–µ—Å—Ç–∏ –ø—Ä–∏ –ø–æ–º–æ—â–∏ –ø–µ—Ä–µ—Å–ª–∞–Ω–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
      if($args[1] != ''){ // –ü—Ä–æ–≤–µ—Ä–∏–ª–∏ –≤–≤–µ–ª–∏ –ª–∏ –Ω–∞–º –¥–≤–∞ –∞—Ä–≥—É–º–µ–Ω—Ç–∞ (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏ —Å—É–º–º–∞) –µ—Å–ª–∏ –ø–µ—Ä–µ—Å–ª–∞–Ω–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–µ—Ç
        $trUser = $args[0]; // –ó–∞–ø–∏—Å–∞–ª–∏ –∫–æ–º—É –ø–µ—Ä–µ–≤–µ—Å—Ç–∏ –∏–∑ –∞—Ä–≥—É–º–µ—Ç–∞
        $sumTr = preg_replace('/\D/', '', $args[1]); // –∑–∞–º–µ–Ω–∏–ª–∏ –≤ —Å—É–º–º–µ id –Ω–∞ —Å—É–º–º—É –ø–µ—Ä–µ–≤–æ–¥–∞
      }else{
        $vk->sendMessage($peer_id, "@id{$id} ({$user['nick']}) –Ω–µ —É–∫–∞–∑–∞–ª–∏ –∫–æ–º—É –ø–µ—Ä–µ–≤–µ—Å—Ç–∏ –≤–∞–ª—é—Ç—É!");
        exit; // –ó–∞–≤–µ—Ä—à–∏–ª–∏ —Å–∫—Ä–∏–ø—Ç —Ç.–∫. –Ω–µ —É–∫–∞–∑–∞–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥–∞
      }
    }
    $trUser = preg_replace('/\D/', '', $trUser); // –£–±—Ä–∞–ª–∏ –≤—Å–µ –±—É–∫–≤—ã –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π id –ø–æ–ª—å–∑–æ–∞–≤—Ç–µ–ª—è –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥–∞
    if($trUser == ''){ // –ø—Ä–æ–≤–µ—Ä—è–µ–º —Å—É–º–º—É –Ω–∞ –ø—É—Å—Ç–æ—Ç—É (–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
      $vk->sendMessage($peer_id, "@id{$id} ({$user['nick']}) –Ω–µ —É–∫–∞–∑–∞–ª–∏ —Å—É–º–º—É –ø–µ—Ä–µ–≤–æ–¥–∞!");
      exit; // –¢.–∫. —Å—É–º–º–∞ –Ω–µ —É–∫–∞–∑–∞–Ω–∞ –º—ã –∑–∞–≤–µ—Ä—à–∏–ª–∏ —Å–∫—Ä–∏–ø—Ç
    }else{ // –ï—Å–ª–∏ —Å—É–º–º–∞ —É–∫–∞–∑–∞–Ω–∞, —Ç–æ –¥–µ–ª–∞–µ–º –ø–µ—Ä–µ–≤–æ–¥ (–ø–æ—á—Ç–∏)
      $findTrUser = R::findOne('users', 'user_id = ?', [$trUser]);
      if($findTrUser){
        $findTrUser['balance'] = $findTrUser['balance'] + $sumTr; // –û—Ç–ø—Ä–∞–≤–∏–ª–∏ —É–∫–∞–∑–∞–Ω–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —Å—É–º–º—É
        $user['balance'] = $user['balance'] - $sumTr; // –°–Ω—è–ª–∏ —ç—Ç—É —Å—É–º–º—É —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∫–æ—Ç–æ—Ä—ã–π –æ—Ç–ø—Ä–∞–≤–∏–ª
        R::store($findTrUser); // –ó–∞–ø–∏—Å–∞–ª–∏ –≤ –±–∞–∑—É
        R::store($user); // –ó–∞–ø–∏—Å–∞–ª–∏ –≤ –±–∞–∑—É
        $vk->sendMessage($peer_id, "@id{$id} ({$user['nick']}), –≤—ã —É—Å–ø–µ—à–Ω–æ –ø–µ—Ä–µ–¥–∞–ª–∏ {$sumTr} –∫—Ä–µ–º–ø–∞—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é @id{$findTrUser['user_id']} ({$findTrUser['nick']})"); // –ü–∏—à–µ–º —á—Ç–æ –ø–µ—Ä–µ–≤–æ–¥ –ø—Ä–æ—à–µ–ª —É—Å–ø–µ—à–Ω–æ
        $vk->sendMessage($findTrUser['user_id'], "@id{$id} ({$user['nick']}) –ø–µ—Ä–µ–¥–∞–ª(–∞) –≤–∞–º {$sumTr} –∫—Ä–µ–º–ø–∞—è )"); // –ü–∏—à–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —á—Ç–æ –µ–º—É –∫–∏–Ω—É–ª–∏ –∫–æ–∏–Ω–æ–≤
      }else{
        $vk->sendMessage($peer_id, "@id{$id} ({$user['nick']}), —É–∫–∞–∑–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –±—ã–ª –Ω–∞–π–¥–µ–Ω –≤ –±–∞–∑–µ!");
        exit; // –≤ –±–∞–∑–µ –Ω–µ—Ç —É–∫–∞–∑–∞–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑-–∑–∞ —á–µ–≥–æ –∑–∞–≤–µ—Ä—à–∞–µ–º —Å–∫—Ä–∏–ø—Ç
      }
    }
  }
  if(in_array($cmd, ['–æ–Ω–ª–∞–π–Ω', 'online'])){
    if($chat_id > 0){ // –ï—Å–ª–∏ —ç—Ç–æ –±–µ—Å–µ–¥–∞
      $members = $vk->request('messages.getConversationMembers', ['peer_id' => $peer_id]); // –ó–∞–ø—Ä–æ—Å –Ω–∞ –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö –±–µ—Å–µ–¥—ã
      foreach ($members['profiles'] as $useronline) { // –ü—Ä–∏ –ø–æ–º–æ—â–∏ foreach –ø—Ä–æ–∏–∑–≤–æ–¥–∏–º —Ä–∞–±–æ—Ç—É –Ω–∞–¥ –¥–∞–Ω–Ω—ã–º–∏ –∏–∑ –ø—Ä–∏—à–µ–¥—à–µ–≥–æ –Ω–∞–º –º–∞—Å—Å–∏–≤–∞
        if ($useronline['online'] == 1) { // –ï—Å–ª–∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ —Å–µ—Ç–∏
          $userOnline++; // –î–æ–±–∞–≤–ª—è–µ–º 1 –∫ –æ–±—â–µ–º—É —á–∏—Å–ª—É –æ–Ω–ª–∞–π–Ω–∞

          $userInfoOnline = $vk->request("users.get", ["user_ids" => $useronline['id'], "fields" => "last_seen"]); // –ó–∞–ø—Ä–æ—Å –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
          $first_nameOnline = $userInfoOnline[0]['first_name']; // –ò–º—è
          $last_nameOnline = $userInfoOnline[0]['last_name']; // –§–∞–º–∏–ª–∏—è
          $platformOnline = $userInfoOnline[0]['last_seen']['platform']; // –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞
          if ($platformOnline >= 1 && $platformOnline <= 5) { // 1 - 5 –æ—Ç–Ω–µ—Å–µ–º –∫ —Ç–µ–ª–µ—Ñ–æ–Ω–∞–º
            $platformOnline = 'üì±';
          }else{ // –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ü–ö
            $platformOnline = 'üíª';
          }
          $Onlinelist .= "üó£ @id{$useronline['id']} ({$first_nameOnline} {$last_nameOnline})"."   - ".$platformOnline."\n"; // –°–æ—Å—Ç–∞–≤–∏–ª–∏ —Ç–µ–∫—Å—Ç —Å –æ–Ω–ª–∞–π–Ω –ª—é–¥—å–º–∏
        }
      }
      $vk->sendMessage($peer_id, "
      üìç –°–µ–π—á–∞—Å –≤ —Å–µ—Ç–∏: {$userOnline} üìç:
      {$Onlinelist}
      ");
    }else{ // –ï—Å–ª–∏ —ç—Ç–æ –ª—Å —Å –±–æ—Ç–æ–º
      $vk->sendMessage($peer_id, "–ö–æ–º–∞–Ω–¥–∞ '–û–Ω–ª–∞–π–Ω' –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ –≤ –±–µ—Å–µ–¥–∞—Ö");
    }
  }
  if(in_array($cmd, ['–ø–æ–≥–æ–¥–∞', '–ø–æ–≥–æ–¥–∫–∞', 'weather'])){
    $city = implode(" ", $args); // –û–±—ä–µ–¥–∏–Ω–∏–ª–∏ —Ç–µ–∫—Å—Ç –ø–æ—Å–ª–µ –∫–æ–º–∞–Ω–¥—ã –≤ –µ–¥–∏–Ω—ã–π
    if($city == ''){ // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —É–∫–∞–∑–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞
      $vk->sendMessage($peer_id, "–í—ã –Ω–µ —É–∫–∞–∑–∞–ª–∏ –≥–æ—Ä–æ–¥. –ü—Ä–∏–º–µ—Ä: –ü–æ–≥–æ–¥–∞ –ú–æ—Å–∫–≤–∞");
      exit; // –ó–∞–≤–µ—Ä—à–∞–µ–º —Å–∫—Ä–∏–ø—Ç —Ç.–∫. –Ω–µ —É–∫–∞–∑–∞–Ω –≥–æ—Ä–æ–¥
    }
    $OWApi_key = 'c6c48db8e2970d6002267e6bcba21e1d'; // –í–∞—à –∫–ª—é—á –æ—Ç OpenWeatherMap - 18486676487135921cb7c6c8bbb44b3e
    $weather=json_decode(file_get_contents("https://api.openweathermap.org/data/2.5/weather?q={$city}&units=metric&appid={$OWApi_key}&lang=ru")); // –°–æ—Å—Ç–∞–≤–∏–ª–∏ –∑–∞–ø—Ä–æ—Å –∫ OpenWeatherMap
    if(empty($weather)){ // –ï—Å–ª–∏ –æ—Ç–≤–µ—Ç –Ω–µ –ø—Ä–∏—à–µ–ª
      $vk->sendMessage($peer_id, "‚úñ –û–π.. –ü—Ä–æ—Å—Ç–∏ —è –Ω–µ –ø–æ–Ω—è–ª–∞, —á—Ç–æ —ç—Ç–æ –∑–∞ –≥–æ—Ä–æ–¥ —Ç–∞–∫–æ–π üòø");
    }else{ // –ï—Å–ª–∏ –æ—Ç–≤–µ—Ç –µ—Å—Ç—å, —Ç–æ —Å–æ—Å—Ç–∞–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç –¥–ª—è –≤—ã–≤–æ–¥–∞
      $list = "–í –≥–æ—Ä–æ–¥–µ " . $weather->name; // –ù–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞
      $list .= "\nüîÆ –ü–æ–≥–æ–¥–∞: " . $weather->weather[0]->description; // –ù–∞–∑–≤–∞–Ω–∏–µ –ø–æ–≥–æ–¥–∞ (–ø—Ä–∏–º–µ—Ä: –æ–±–ª–∞—á–Ω–æ/—Å–æ–ª–Ω–µ—á–Ω–æ)
      $list .= "\nüí® –í–µ—Ç–µ—Ä: " . $weather->wind->speed. " m/s "; // –°–∫–æ—Ä–æ—Å—Ç—å –≤–µ—Ç—Ä–∞
      $list .= "\nüå° –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: " . $weather->main->temp . "¬∞C"; // –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞
      $list .= "\n‚òÅ –û–±–ª–∞—á–Ω–æ—Å—Ç—å: " . $weather->clouds->all . "%"; // –û–±–ª–∞—á–Ω–æ—Å—Ç—å –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö
      $list .= "\nüìä –î–∞–≤–ª–µ–Ω–∏–µ: " . $weather->main->pressure . " –º–º.—Ä—Ç.—Å—Ç"; // –î–∞–≤–ª–µ–Ω–∏–µ
      $vk->sendMessage($peer_id, $list); // –í—ã–≤–µ–ª–∏ –ø–æ–≥–æ–¥—É
    }
  }
//--------------------------------------------------------------------------
  if(implode(' ', $messages) == '—è –∞–¥–º–∏–Ω –±–µ—Å–µ–¥—ã?'){//–µ—Å–ª–∏ —á–µ–ª–æ–≤–µ–∫ —è–≤–ª—è–µ—Ç—Å—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º
    if($vk->isAdmin($peer_id, $id)){
        $vk->sendMessage($peer_id, "@id{$id} ({$user['nick']}), –≤—ã –∞–¥–º–∏–Ω!");
    }else{
      $vk->sendMessage($peer_id, "–£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —ç—Ç–æ–π –∫–æ–º–∞–Ω–¥–µ!");
    } 
  }
//--------------------------------------------------------------------------
 if($chat_act->type == 'chat_kick_user'){//–∞–≤—Ç–æ –∫–∏–∫ –∏–∑ –±–µ—Å–µ–¥—ã
    $userInfo = $vk->request("users.get", ["user_ids" => $id]);
    $first_name = $userInfo[0]['first_name'];
	if($chat_act->member_id <= '-') exit; // –¢.–∫. –∏–¥ –Ω–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∑–∞–≤–µ—Ä—à–∏–ª–∏ —Å–∫—Ä–∏–ø—Ç
    $strtkick = "@id{$chat_act->member_id} ({$first_name}) –±—ã–ª(–∞) –∏—Å–∫–ª—é—á–µ–Ω(–∞) –∑–∞ —Ç–æ —á—Ç–æ –ø–æ–∫–∏–Ω—É–ª(–∞) –±–µ—Å–µ–¥—É!";
    $vk->request('messages.send', ['peer_id' => $peer_id, 'message' => $strtkick, 'attachment' => "photo566868656_457239109"]);
    $vk->request('messages.removeChatUser', ['chat_id' => $chat_id, 'member_id' => $chat_act->member_id]);
  }
  
if($chat_act->type == 'chat_title_update'){
    $chatSettings = R::findOne('settings', 'peer_id = ?', [$peer_id]);
    $chatSettings->title = $chat_act->text;
    R::store($chatSettings);
    $vk->sendMessage($peer_id, "üí¨ –ù–æ–≤–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —á–∞—Ç–∞: {$chat_act->text}");
	//$vk->request('messages.editChat', ['chat_id' => $chat_id, 'title' => 'title']);//–∏–∑–º–µ–Ω—è–µ—Ç –Ω–∞–∑–≤–∞–Ω–∏–µ —á–∞—Ç–∞
  }
//--------------------------------------------------------------------------
}
